<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="loginDAO">

	<insert id="regInfUser" parameterType="UserRegVO">
		INSERT INTO 
			pub_user (
				USER_REGDATE,
				USER_EMAIL,
				USER_PW,
				USER_NAME,
				USER_PHO_NUM,
				USER_BIRTH,
				USER_SEX,
				USER_BLOG,
				USER_INSTA,
				USER_YOUTU,
				USER_TIKTOK,
				USER_ETC	)
		VALUES 
			(
			NOW(),
			#{userEmail},
			#{userPW},
			#{userName},
			#{userPhone},
			#{userBirth},
			#{userGender},
			#{userBlog},
			#{userInsta},
			#{userYoutube},
			#{userTiktok},
			#{userETC}		)
	</insert>
	
	<insert id="regBssUser" parameterType="UserRegVO">
		INSERT INTO 
			pub_buss (
				BUSS_REGDATE,
				BUSS_EMAIL,
				BUSS_PW,
				BUSS_NAME,
				BUSS_PHO_NUM,
				BUSS_BIRTH,
				BUSS_SEX	)
		VALUES 
			(
			NOW(),
			#{userEmail},
			#{userPW},
			#{userName},
			#{userPhone},
			#{userBirth},
			#{userGender}	)
	</insert>
	
	<select id="existByInfEmail" parameterType="java.lang.String" resultType="boolean">
		SELECT 
			EXISTS 
				(SELECT 
					1 
				FROM 
					pub_user 
				WHERE 
					USER_EMAIL = #{email}	)
	</select>
	
	<select id="existByBssEmail" parameterType="java.lang.String" resultType="boolean">
		SELECT 
			EXISTS 
				(SELECT 
					1 
				FROM 
					pub_buss 
				WHERE 
					BUSS_EMAIL = #{email}	)
	</select>
	
	<!-- 인플루언서 -->
	<select id="findInfByEmail" parameterType="string" resultType="UserRegVO">
    	SELECT 
        	USER_IDX       AS userIdx,
        	USER_EMAIL     AS userEmail,
        	USER_PW        AS userPW,     <!-- 해시 -->
        	USER_NICKNAME  AS userNickName
    	FROM 
    		pub_user
   		WHERE 
   			USER_EMAIL = #{email}
      	AND 
      		USER_DELYN = 'N'
    	LIMIT 1
	</select>

	<!-- 사업자 -->
	<select id="findBssByEmail" parameterType="string" resultType="UserRegVO">
    	SELECT 
        	USER_IDX       AS userIdx,
        	USER_EMAIL     AS userEmail,
        	USER_PW        AS userPW,     <!-- 해시 -->
        	USER_NICKNAME  AS userNickName
    	FROM
    		pub_buss
    	WHERE
    		USER_EMAIL = #{email}
      	AND
      		USER_DELYN = 'N'
    	LIMIT 1
	</select>

<!--  
	<select id="chkInfLogin" parameterType="map" resultType="java.lang.Integer">
		SELECT 
			USER_IDX
		FROM
			pub_user
		WHERE
			USER_EMAIL = #{id} AND
			USER_PW = #{pw}
	</select>
	
	<select id="chkBssLogin" parameterType="map" resultType="java.lang.Integer">
		SELECT 
			BUSS_IDX
		FROM
			pub_buss
		WHERE
			BUSS_EMAIL = #{id} AND
			BUSS_PW = #{pw}
	</select>
-->
	
	<select id="getInfNickName" parameterType="int" resultType="java.lang.String">
		SELECT
			USER_NICKNAME
		FROM
			pub_user
		WHERE
			USER_IDX = #{value}
	</select>

	<select id="getBssNickName" parameterType="int" resultType="java.lang.String">
		/* 나중에 사업자 닉네임 추가 필요 */
		SELECT
			BUSS_NAME
		FROM
			pub_buss
		WHERE
			BUSS_IDX = #{value}
	</select>
	
	<update id="updateInfVisitCnt" parameterType="int">
		UPDATE
			pub_user
		SET
			USER_VISIT_CNT = USER_VISIT_CNT + 1
		WHERE
			USER_IDX = #{value}
	</update>
	
	<update id="updateBssVisitCnt" parameterType="int">
		UPDATE
			bss_user
		SET
			BUSS_VISIT_CNT = BUSS_VISIT_CNT + 1
		WHERE
			BUSS_IDX = #{value}
	</update>
	
</mapper>